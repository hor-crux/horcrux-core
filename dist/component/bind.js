define(["require", "exports", "observer", "../attribute/attribute"], function (require, exports, observer_1, attribute_1) {
    var regex = /\{\{(.+)\}\}/gm;
    function bindTextNode(node, model) {
        regex.lastIndex = 0;
        var match = regex.exec(node.textContent);
        if (match) {
            var path = match[1];
            var originalText = node.textContent;
            var observer = new observer_1.PathObserver(model, path);
            var r = new RegExp("\{\{" + path + "\}\}", "g");
            var cb = function (newVal, oldVal) {
                node.textContent = originalText.replace(r, newVal);
            };
            observer.open(cb);
            cb(model[path], null);
        }
    }
    function bindAttribute(node, attr, model) {
        var match = regex.exec(attr.value);
        if (match) {
            var path = match[1];
            if (attribute_1.Attributes[attr.name.toLowerCase()] !== undefined) {
                bindCustomAttribute(node, attr, model, path);
            }
            else if (typeof model[path] === "function") {
                bindFunctionAttribute(node, attr, model, path);
            }
            else {
                bindTextAttribute(node, attr, model, path);
            }
        }
    }
    function bindTextAttribute(node, attr, model, path) {
        var originalValue = attr.value;
        var observer = new observer_1.PathObserver(model, path);
        var r = new RegExp("\{\{" + path + "\}\}", "g");
        var cb = function (newVal, oldVal) {
            attr.value = originalValue.replace(r, newVal);
        };
        observer.open(cb);
        cb(model[path], null);
    }
    function bindFunctionAttribute(node, attr, model, path) {
        node[attr.name.toLocaleLowerCase()] = function (event) {
            model[path](event);
        };
    }
    function bindCustomAttribute(node, attr, model, path) {
        var customAttr = new attribute_1.Attributes[attr.name](node, attr, model, path);
        var observer = new observer_1.PathObserver(model, path);
        var cb = function (newVal, oldVal) {
            customAttr.newJSValue(newVal);
        };
        observer.open(cb);
        cb(model[path], null);
    }
    function bindNode(node, model) {
        var isTextNode = node.nodeType === 3;
        var hasOnlyTextNodes = node.childElementCount === 0;
        if (isTextNode || hasOnlyTextNodes) {
            bindTextNode(node, model);
        }
        if (node.attributes)
            Array.prototype.forEach.call(node.attributes, function (attr) {
                bindAttribute(node, attr, model);
            });
    }
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.default = bindNode;
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudC9iaW5kLnRzIl0sIm5hbWVzIjpbImJpbmRUZXh0Tm9kZSIsImJpbmRBdHRyaWJ1dGUiLCJiaW5kVGV4dEF0dHJpYnV0ZSIsImJpbmRGdW5jdGlvbkF0dHJpYnV0ZSIsImJpbmRDdXN0b21BdHRyaWJ1dGUiLCJiaW5kTm9kZSJdLCJtYXBwaW5ncyI6IjtJQUdBLElBQUksS0FBSyxHQUFHLGdCQUFnQixDQUFDO0lBRTdCLHNCQUFzQixJQUFTLEVBQUUsS0FBUztRQUN6Q0EsS0FBS0EsQ0FBQ0EsU0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDcEJBLElBQUlBLEtBQUtBLEdBQUdBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBO1FBQ3pDQSxFQUFFQSxDQUFBQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNWQSxJQUFJQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNwQkEsSUFBSUEsWUFBWUEsR0FBR0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7WUFDcENBLElBQUlBLFFBQVFBLEdBQUdBLElBQUlBLHVCQUFZQSxDQUFDQSxLQUFLQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUM3Q0EsSUFBSUEsQ0FBQ0EsR0FBR0EsSUFBSUEsTUFBTUEsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQUE7WUFFL0NBLElBQUlBLEVBQUVBLEdBQUdBLFVBQUNBLE1BQU1BLEVBQUVBLE1BQU1BO2dCQUN2QkEsSUFBSUEsQ0FBQ0EsV0FBV0EsR0FBR0EsWUFBWUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDcERBLENBQUNBLENBQUNBO1lBQ0ZBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1lBQ2xCQSxFQUFFQSxDQUFD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QUFLQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUM3Q0EsSUFBSUEsRUFBRUEsR0FBR0EsVUFBQ0EsTUFBTUEsRUFBRUEsTUFBTUE7WUFDdkJBLFVBQVVBLENBQUNBLFVBQVVBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQy9CQSxDQUFDQSxDQUFDQTtRQUNGQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNsQkEsRUFBRUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7SUFFdkJBLENBQUNBO0lBR0Qsa0JBQWlDLElBQVMsRUFBRSxLQUFTO1FBQ3BEQyxJQUFJQSxVQUFVQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUNyQ0EsSUFBSUEsZ0JBQWdCQSxHQUFhQSxJQUFLQSxDQUFDQSxpQkFBaUJBLEtBQUtBLENBQUNBLENBQUFBO1FBQzlEQSxFQUFFQSxDQUFBQSxDQUFDQSxVQUFVQSxJQUFJQSxnQkFBZ0JBLENBQUNBLENBQUNBLENBQUNBO1lBQ25DQSxZQUFZQSxDQUFDQSxJQUFJQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0E7WUFDbEJBLEtBQUtBLENBQUNBLFNBQVNBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEVBQUVBLFVBQUFBLElBQUlBO2dCQUNqREEsYUFBYUEsQ0FBQ0EsSUFBSUEsRUFBRUEsSUFBSUEsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFDbENBLENBQUNBLENBQUNBLENBQUFBO0lBQ0pBLENBQUNBO0lBWEQ7OEJBV0MsQ0FBQSIsImZpbGUiOiJjb21wb25lbnQvYmluZC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7UGF0aE9ic2VydmVyfSBmcm9tIFwib2JzZXJ2ZXJcIjtcclxuaW1wb3J0IHtBdHRyaWJ1dGVzfSBmcm9tIFwiLi4vYXR0cmlidXRlL2F0dHJpYnV0ZVwiXHJcblxyXG5sZXQgcmVnZXggPSAvXFx7XFx7KC4rKVxcfVxcfS9nbTtcclxuXHJcbmZ1bmN0aW9uIGJpbmRUZXh0Tm9kZShub2RlOk5vZGUsIG1vZGVsOmFueSk6IHZvaWQge1xyXG5cdHJlZ2V4Lmxhc3RJbmRleCA9IDA7XHJcblx0bGV0IG1hdGNoID0gcmVnZXguZXhlYyhub2RlLnRleHRDb250ZW50KTtcclxuXHRpZihtYXRjaCkge1xyXG5cdFx0bGV0IHBhdGggPSBtYXRjaFsxXTtcclxuXHRcdGxldCBvcmlnaW5hbFRleHQgPSBub2RlLnRleHRDb250ZW50O1xyXG5cdFx0bGV0IG9ic2VydmVyID0gbmV3IFBhdGhPYnNlcnZlcihtb2RlbCwgcGF0aCk7XHJcblx0XHRsZXQgciA9IG5ldyBSZWdFeHAoXCJcXHtcXHtcIiArIHBhdGggKyBcIlxcfVxcfVwiLCBcImdcIilcclxuXHRcdFxyXG5cdFx0bGV0IGNiID0gKG5ld1ZhbCwgb2xkVmFsKSA9PiB7XHJcblx0XHRcdG5vZGUudGV4dENvbnRlbnQgPSBvcmlnaW5hbFRleHQucmVwbGFjZShyLCBuZXdWYWwpO1xyXG5cdFx0fTtcclxuXHRcdG9ic2VydmVyLm9wZW4oY2IpO1xyXG5cdFx0Y2IobW9kZWxbcGF0aF0sIG51bGwpO1xyXG5cdH1cclxufVxyXG5cclxuZnVuY3Rpb24gYmluZEF0dHJpYnV0ZShub2RlOk5vZGUsIGF0dHI6e25hbWU6c3RyaW5nLCB2YWx1ZTpzdHJpbmd9LCBtb2RlbDphbnkpOiB2b2lkIHtcclxuXHRsZXQgbWF0Y2ggPSByZWdleC5leGVjKGF0dHIudmFsdWUpO1xyXG5cdGlmKG1hdGNoKSB7XHJcblx0XHRsZXQgcGF0aCA9IG1hdGNoWzFdO1xyXG5cdFx0XHJcblx0XHRpZihBdHRyaWJ1dGVzW2F0dHIubmFtZS50b0xvd2VyQ2FzZSgpXSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdGJpbmRDdXN0b21BdHRyaWJ1dGUobm9kZSwgYXR0ciwgbW9kZWwsIHBhdGgpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZih0eXBlb2YgbW9kZWxbcGF0aF0gPT09IFwiZnVuY3Rpb25cIikge1xyXG5cdFx0XHRiaW5kRnVuY3Rpb25BdHRyaWJ1dGUobm9kZSwgYXR0ciwgbW9kZWwsIHBhdGgpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGJpbmRUZXh0QXR0cmlidXRlKG5vZGUsIGF0dHIsIG1vZGVsLCBwYXRoKTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGJpbmRUZXh0QXR0cmlidXRlKG5vZGU6Tm9kZSwgYXR0cjp7bmFtZTpzdHJpbmcsIHZhbHVlOnN0cmluZ30sIG1vZGVsOmFueSwgcGF0aDpzdHJpbmcpOiB2b2lkIHtcclxuXHRsZXQgb3JpZ2luYWxWYWx1ZSA9IGF0dHIudmFsdWU7XHJcblx0bGV0IG9ic2VydmVyID0gbmV3IFBhdGhPYnNlcnZlcihtb2RlbCwgcGF0aCk7XHJcblx0bGV0IHIgPSBuZXcgUmVnRXhwKFwiXFx7XFx7XCIgKyBwYXRoICsgXCJcXH1cXH1cIiwgXCJnXCIpXHJcblx0XHJcblx0bGV0IGNiID0gKG5ld1ZhbCwgb2xkVmFsKSA9PiB7XHJcblx0XHRhdHRyLnZhbHVlID0gb3JpZ2luYWxWYWx1ZS5yZXBsYWNlKHIsIG5ld1ZhbCk7XHJcblx0fTtcclxuXHRvYnNlcnZlci5vcGVuKGNiKTtcclxuXHRjYihtb2RlbFtwYXRoXSwgbnVsbCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGJpbmRGdW5jdGlvbkF0dHJpYnV0ZShub2RlOk5vZGUsIGF0dHI6e25hbWU6c3RyaW5nLCB2YWx1ZTpzdHJpbmd9LCBtb2RlbDphbnksIHBhdGg6c3RyaW5nKTogdm9pZCB7XHJcblx0bm9kZVthdHRyLm5hbWUudG9Mb2NhbGVMb3dlckNhc2UoKV0gPSBldmVudCA9PiB7XHJcblx0XHRtb2RlbFtwYXRoXShldmVudCk7XHJcblx0fVxyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gYmluZEN1c3RvbUF0dHJpYnV0ZShub2RlOk5vZGUsIGF0dHI6e25hbWU6c3RyaW5nLCB2YWx1ZTpzdHJpbmd9LCBtb2RlbDphbnksIHBhdGg6c3RyaW5nKTogdm9pZCB7XHJcblx0bGV0IGN1c3RvbUF0dHIgPSBuZXcgQXR0cmlidXRlc1thdHRyLm5hbWVdKG5vZGUsIGF0dHIsIG1vZGVsLCBwYXRoKTtcclxuXHRcclxuXHRsZXQgb2JzZXJ2ZXIgPSBuZXcgUGF0aE9ic2VydmVyKG1vZGVsLCBwYXRoKTtcclxuXHRsZXQgY2IgPSAobmV3VmFsLCBvbGRWYWwpID0+IHtcclxuXHRcdGN1c3RvbUF0dHIubmV3SlNWYWx1ZShuZXdWYWwpO1xyXG5cdH07XHJcblx0b2JzZXJ2ZXIub3BlbihjYik7XHJcblx0Y2IobW9kZWxbcGF0aF0sIG51bGwpO1xyXG5cdFxyXG59XHJcblxyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gYmluZE5vZGUobm9kZTpOb2RlLCBtb2RlbDphbnkpOiB2b2lkIHtcclxuXHRsZXQgaXNUZXh0Tm9kZSA9IG5vZGUubm9kZVR5cGUgPT09IDM7XHJcblx0bGV0IGhhc09ubHlUZXh0Tm9kZXMgPSAoPEVsZW1lbnQ+bm9kZSkuY2hpbGRFbGVtZW50Q291bnQgPT09IDAgXHJcblx0aWYoaXNUZXh0Tm9kZSB8fCBoYXNPbmx5VGV4dE5vZGVzKSB7XHJcblx0XHRiaW5kVGV4dE5vZGUobm9kZSwgbW9kZWwpO1xyXG5cdH1cclxuXHRcclxuXHRpZihub2RlLmF0dHJpYnV0ZXMpXHJcblx0XHRBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKG5vZGUuYXR0cmlidXRlcywgYXR0ciA9PiB7XHJcblx0XHRcdGJpbmRBdHRyaWJ1dGUobm9kZSwgYXR0ciwgbW9kZWwpO1xyXG5cdFx0fSlcclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==