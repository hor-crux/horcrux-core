define(["require", "exports", "./bind", "../attribute/attribute"], function (require, exports, bind_1, attribute_1) {
    function bindAttribute(node, attr, model) {
        bind_1.regex.lastIndex = 0;
        var match = bind_1.regex.exec(attr.value);
        if (match) {
            var path = match[1];
            if (attribute_1.Attributes[attr.name.toLowerCase()] !== undefined) {
                return bindCustomAttribute(node, attr, model, path);
            }
            else if (!!/\(.*\)/.exec(attr.value)) {
                bindFunctionWithParamAttribute(node, attr, model, path);
            }
            else if (typeof model.get(path) === "function") {
                bindFunctionAttribute(node, attr, model, path);
            }
            else {
                bindTextAttribute(node, attr, model, path);
            }
        }
    }
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.default = bindAttribute;
    function bindTextAttribute(node, attr, model, path) {
        var originalValue = attr.value;
        var _a = model.get(path), object = _a.object, value = _a.value;
        var observer = new PathObserver(object, path);
        var r = new RegExp("\{\{" + path + "\}\}", "g");
        var cb = function (newVal, oldVal) {
            attr.value = originalValue.replace(r, newVal);
        };
        observer.open(cb);
        cb(value, null);
    }
    var regex_params = /\((.+)\)/;
    var regex_function = /.*\(/;
    function bindFunctionWithParamAttribute(node, attr, model, path) {
        regex_params.lastIndex = 0;
        regex_function.lastIndex = 0;
        var params = regex_params.exec(path)[1]
            .split(",")
            .map(function (param) { return param.trim(); })
            .map(function (param) { return model.get(param).value; });
        var functionName = regex_function.exec(path)[1];
        var _a = model.get(path), object = _a.object, value = _a.value;
        node[attr.name.toLocaleLowerCase()] = function (event) {
            value.apply(object, params);
        };
    }
    function bindFunctionAttribute(node, attr, model, path) {
        var _a = model.get(path), object = _a.object, value = _a.value;
        node[attr.name.toLocaleLowerCase()] = function (event) {
            value.call(object, event);
        };
    }
    function bindCustomAttribute(node, attr, model, path) {
        var customAttr = new attribute_1.Attributes[attr.name](node, attr, model, path);
        var _a = model.get(path), object = _a.object, value = _a.value;
        var observer = new PathObserver(object, path);
        var cb = function (newVal, oldVal) {
            customAttr.newJSValue(newVal);
        };
        observer.open(cb);
        cb(value, null);
    }
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJpbmQvYmluZGF0dHJpYnV0ZS50cyJdLCJuYW1lcyI6WyJiaW5kQXR0cmlidXRlIiwiYmluZFRleHRBdHRyaWJ1dGUiLCJiaW5kRnVuY3Rpb25XaXRoUGFyYW1BdHRyaWJ1dGUiLCJiaW5kRnVuY3Rpb25BdHRyaWJ1dGUiLCJiaW5kQ3VzdG9tQXR0cmlidXRlIl0sIm1hcHBpbmdzIjoiO0lBSUEsdUJBQXNDLElBQVMsRUFBRSxJQUFTLEVBQUUsS0FBVztRQUV0RUEsWUFBS0EsQ0FBQ0EsU0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDcEJBLElBQUlBLEtBQUtBLEdBQUdBLFlBQUtBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBQ25DQSxFQUFFQSxDQUFBQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNWQSxJQUFJQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUVwQkEsRUFBRUEsQ0FBQUEsQ0FBQ0Esc0JBQVVBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBLEtBQUtBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO2dCQUN0REEsTUFBTUEsQ0FBQ0EsbUJBQW1CQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxFQUFFQSxLQUFLQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNyREEsQ0FBQ0E7WUFDREEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3JDQSw4QkFBOEJBLENBQUNBLElBQUlBLEVBQUVBLElBQUlBLEVBQUVBLEtBQUtBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1lBQ3pEQSxDQUFDQTtZQUNEQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFBQSxDQUFDQSxP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LCJmaWxlIjoiYmluZC9iaW5kYXR0cmlidXRlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtyZWdleH0gZnJvbSBcIi4vYmluZFwiXHJcbmltcG9ydCB7QXR0cmlidXRlc30gZnJvbSBcIi4uL2F0dHJpYnV0ZS9hdHRyaWJ1dGVcIlxyXG5pbXBvcnQgTW9kZWwgZnJvbSBcIi4vbW9kZWxcIlxyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gYmluZEF0dHJpYnV0ZShub2RlOk5vZGUsIGF0dHI6QXR0ciwgbW9kZWw6TW9kZWwpOiB2b2lkIHtcclxuXHRcclxuXHRyZWdleC5sYXN0SW5kZXggPSAwO1xyXG5cdGxldCBtYXRjaCA9IHJlZ2V4LmV4ZWMoYXR0ci52YWx1ZSk7XHJcblx0aWYobWF0Y2gpIHtcclxuXHRcdGxldCBwYXRoID0gbWF0Y2hbMV07XHJcblx0XHRcclxuXHRcdGlmKEF0dHJpYnV0ZXNbYXR0ci5uYW1lLnRvTG93ZXJDYXNlKCldICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0cmV0dXJuIGJpbmRDdXN0b21BdHRyaWJ1dGUobm9kZSwgYXR0ciwgbW9kZWwsIHBhdGgpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZighIS9cXCguKlxcKS8uZXhlYyhhdHRyLnZhbHVlKSkge1xyXG5cdFx0XHRiaW5kRnVuY3Rpb25XaXRoUGFyYW1BdHRyaWJ1dGUobm9kZSwgYXR0ciwgbW9kZWwsIHBhdGgpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZih0eXBlb2YgbW9kZWwuZ2V0KHBhdGgpID09PSBcImZ1bmN0aW9uXCIpIHtcclxuXHRcdFx0YmluZEZ1bmN0aW9uQXR0cmlidXRlKG5vZGUsIGF0dHIsIG1vZGVsLCBwYXRoKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRiaW5kVGV4dEF0dHJpYnV0ZShub2RlLCBhdHRyLCBtb2RlbCwgcGF0aCk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5mdW5jdGlvbiBiaW5kVGV4dEF0dHJpYnV0ZShub2RlOk5vZGUsIGF0dHI6QXR0ciwgbW9kZWw6TW9kZWwsIHBhdGg6c3RyaW5nKTogdm9pZCB7XHJcblx0bGV0IG9yaWdpbmFsVmFsdWUgPSBhdHRyLnZhbHVlO1xyXG5cdFxyXG5cdGxldCB7b2JqZWN0LCB2YWx1ZX0gPSBtb2RlbC5nZXQocGF0aCk7XHJcblx0XHJcblx0bGV0IG9ic2VydmVyID0gbmV3IFBhdGhPYnNlcnZlcihvYmplY3QsIHBhdGgpO1xyXG5cdGxldCByID0gbmV3IFJlZ0V4cChcIlxce1xce1wiICsgcGF0aCArIFwiXFx9XFx9XCIsIFwiZ1wiKVxyXG5cdFxyXG5cdGxldCBjYiA9IChuZXdWYWwsIG9sZFZhbCkgPT4ge1xyXG5cdFx0YXR0ci52YWx1ZSA9IG9yaWdpbmFsVmFsdWUucmVwbGFjZShyLCBuZXdWYWwpO1xyXG5cdH07XHJcblx0b2JzZXJ2ZXIub3BlbihjYik7XHJcblx0Y2IodmFsdWUsIG51bGwpO1xyXG59XHJcblxyXG5sZXQgcmVnZXhfcGFyYW1zID0gL1xcKCguKylcXCkvO1xyXG5sZXQgcmVnZXhfZnVuY3Rpb24gPSAvLipcXCgvO1xyXG5cclxuZnVuY3Rpb24gYmluZEZ1bmN0aW9uV2l0aFBhcmFtQXR0cmlidXRlKG5vZGU6Tm9kZSwgYXR0cjpBdHRyLCBtb2RlbDpNb2RlbCwgcGF0aDpzdHJpbmcpOiB2b2lkIHtcclxuXHRyZWdleF9wYXJhbXMubGFzdEluZGV4ID0gMDtcclxuXHRyZWdleF9mdW5jdGlvbi5sYXN0SW5kZXggPSAwO1xyXG5cdFxyXG5cdGxldCBwYXJhbXMgPSByZWdleF9wYXJhbXMuZXhlYyhwYXRoKVsxXVxyXG5cdFx0LnNwbGl0KFwiLFwiKVxyXG5cdFx0Lm1hcChwYXJhbSA9PiB7cmV0dXJuIHBhcmFtLnRyaW0oKX0pXHJcblx0XHQubWFwKHBhcmFtID0+IHtyZXR1cm4gbW9kZWwuZ2V0KHBhcmFtKS52YWx1ZX0pO1xyXG5cdFx0XHJcblx0bGV0IGZ1bmN0aW9uTmFtZSA9IHJlZ2V4X2Z1bmN0aW9uLmV4ZWMocGF0aClbMV07XHJcblx0XHJcblx0bGV0IHtvYmplY3QsIHZhbHVlfSA9IG1vZGVsLmdldChwYXRoKTtcclxuXHRcclxuXHRub2RlW2F0dHIubmFtZS50b0xvY2FsZUxvd2VyQ2FzZSgpXSA9IGV2ZW50ID0+IHtcclxuXHRcdHZhbHVlLmFwcGx5KG9iamVjdCwgcGFyYW1zKTtcclxuXHR9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGJpbmRGdW5jdGlvbkF0dHJpYnV0ZShub2RlOk5vZGUsIGF0dHI6QXR0ciwgbW9kZWw6TW9kZWwsIHBhdGg6c3RyaW5nKTogdm9pZCB7XHJcblx0bGV0IHtvYmplY3QsIHZhbHVlfSA9IG1vZGVsLmdldChwYXRoKTtcclxuXHRcclxuXHRub2RlW2F0dHIubmFtZS50b0xvY2FsZUxvd2VyQ2FzZSgpXSA9IGV2ZW50ID0+IHtcclxuXHRcdHZhbHVlLmNhbGwob2JqZWN0LCBldmVudCk7XHJcblx0fVxyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gYmluZEN1c3RvbUF0dHJpYnV0ZShub2RlOk5vZGUsIGF0dHI6QXR0ciwgbW9kZWw6TW9kZWwsIHBhdGg6c3RyaW5nKTogdm9pZCB7XHJcblx0bGV0IGN1c3RvbUF0dHIgPSBuZXcgQXR0cmlidXRlc1thdHRyLm5hbWVdKG5vZGUsIGF0dHIsIG1vZGVsLCBwYXRoKTtcclxuXHRcclxuXHRsZXQge29iamVjdCwgdmFsdWV9ID0gbW9kZWwuZ2V0KHBhdGgpO1xyXG5cdFxyXG5cdGxldCBvYnNlcnZlciA9IG5ldyBQYXRoT2JzZXJ2ZXIob2JqZWN0LCBwYXRoKTtcclxuXHRsZXQgY2IgPSAobmV3VmFsLCBvbGRWYWwpID0+IHtcclxuXHRcdGN1c3RvbUF0dHIubmV3SlNWYWx1ZShuZXdWYWwpO1xyXG5cdH07XHJcblx0b2JzZXJ2ZXIub3BlbihjYik7XHJcblx0Y2IodmFsdWUsIG51bGwpO1xyXG5cdFxyXG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9