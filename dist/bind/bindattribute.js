define(["require", "exports", "./bind", "../attribute/attribute", "observejs"], function (require, exports, bind_1, attribute_1, observejs_1) {
    function bindAttribute(node, attr, model) {
        //TODO use Bindings
        //TODO also detect CustomAttribute with non-{{}} Values
        //TODO call Alternative if {{.*}} does not match: setProperty
        if (attribute_1.Attributes[attr.name.toLowerCase()] !== undefined) {
            return bindCustomAttribute(node, attr, model);
        }
        bind_1.regex.lastIndex = 0;
        var match = bind_1.regex.exec(attr.value);
        if (match) {
            var path = match[1];
            if (!!/\(.*\)/.exec(attr.value)) {
                bindFunctionWithParamAttribute(node, attr, model, path);
            }
            else if (typeof model.get(path).value === "function") {
                bindFunctionAttribute(node, attr, model, path);
            }
            else if (!!node.properties && node.properties.indexOf(attr.name) > -1) {
                bindProperty(node, attr, model, path);
            }
            else {
                bindTextAttribute(node, attr, model, path);
            }
        }
    }
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.default = bindAttribute;
    function bindTextAttribute(node, attr, model, path) {
        var originalValue = attr.value;
        var _a = model.get(path), object = _a.object, value = _a.value;
        var observer = new observejs_1.PathObserver(object, path);
        var r = new RegExp("\{\{" + path + "\}\}", "g");
        var cb = function (newVal, oldVal) {
            attr.value = originalValue.replace(r, newVal);
        };
        observer.open(cb);
        cb(value, null);
    }
    function bindProperty(node, attr, model, path) {
        (function (node, attr, model, path) {
            var _a = model.get(path), object = _a.object, value = _a.value;
            var observer = new observejs_1.PathObserver(object, path);
            var cb = function (newVal, oldVal) {
                node[attr.name] = newVal;
            };
            observer.open(cb);
            cb(value, null);
            node.removeAttribute(attr.name);
        })(node, attr, model, path);
    }
    var regex_params = /\((.+)\)/;
    var regex_function = /(.*)\(/;
    function bindFunctionWithParamAttribute(node, attr, model, path) {
        regex_params.lastIndex = 0;
        regex_function.lastIndex = 0;
        var params = regex_params.exec(path)[1]
            .split(",")
            .map(function (param) { return param.trim(); })
            .map(function (param) {
            var value = model.get(param).value;
            return typeof value === "undefined" ? param : value;
        });
        //TODO map params to types e.g. 'true' to boolean, 1.2 to number...
        var functionName = regex_function.exec(path)[1];
        var _a = model.get(functionName), object = _a.object, value = _a.value;
        node.removeAttribute(attr.name);
        node[attr.name.toLocaleLowerCase()] = function (event) {
            value.apply(object, params);
        };
    }
    function bindFunctionAttribute(node, attr, model, path) {
        var _a = model.get(path), object = _a.object, value = _a.value;
        node.removeAttribute(attr.name);
        node[attr.name.toLocaleLowerCase()] = function (event) {
            value.call(object, event);
        };
    }
    function bindCustomAttribute(node, attr, model) {
        var customAttr = new attribute_1.Attributes[attr.name](node, attr, model);
        /*
        let {object, value} = model.get(path);
        
        let observer = new PathObserver(object, path);
        let cb = (newVal, oldVal) => {
            customAttr.newJSValue(newVal);
        };
        observer.open(cb);
        cb(value, null);
        */
    }
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJpbmQvYmluZGF0dHJpYnV0ZS50cyJdLCJuYW1lcyI6WyJiaW5kQXR0cmlidXRlIiwiYmluZFRleHRBdHRyaWJ1dGUiLCJiaW5kUHJvcGVydHkiLCJiaW5kRnVuY3Rpb25XaXRoUGFyYW1BdHRyaWJ1dGUiLCJiaW5kRnVuY3Rpb25BdHRyaWJ1dGUiLCJiaW5kQ3VzdG9tQXR0cmlidXRlIl0sIm1hcHBpbmdzIjoiO0lBS0EsdUJBQXNDLElBQVMsRUFBRSxJQUFTLEVBQUUsS0FBVztRQUV0RUEsbUJBQW1CQTtRQUNuQkEsdURBQXVEQTtRQUN2REEsNkRBQTZEQTtRQUU3REEsRUFBRUEsQ0FBQUEsQ0FBQ0Esc0JBQVVBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBLEtBQUtBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3REQSxNQUFNQSxDQUFDQSxtQkFBbUJBLENBQUNBLElBQUlBLEVBQUVBLElBQUlBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1FBQy9DQSxDQUFDQTtRQUNEQSxZQUFLQSxDQUFDQSxTQUFTQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNwQkEsSUFBSUEsS0FBS0EsR0FBR0EsWUFBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFDbkNBLEVBQUVBLENBQUFBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBO1lBQ1ZBLElBQUlBLElBQUlBLEdBQUdBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBRXBCQSxFQUFFQSxDQUFBQSxDQUFDQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDaENBLDhCQUE4QkEsQ0FBQ0EsSUFBSUEsRUFBRUEsSUFBSUEsRUFBRUEsS0FBS0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDekRBLENBQUNBO1lBQ0RBLElBQUlBLENBQUNBLEVBQUVBLENBQUFBLENBQUNBLE9BQU9BLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLEtBQUtBLEtBQUtBLFVBQVVBLENBQUNBLENBQUNBLENBQUNBO2dCQUNyREEscUJBQXFCQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxFQUFFQSxLQUFLQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNoREEsQ0FBQ0E7WUFFREEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQUEsQ0FBQ0EsQ0FBQ0EsQ0FBT0EsSUFBS0EsQ0FBQ0EsVUFBVUEsSUFBVUEsSUFBS0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3BGQSxZQUFZQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxFQUFFQSxLQUFLQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUN2Q0EsQ0FBQ0E7WUFNREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ0xBLGlCQUFpQkEsQ0FBQ0EsSUFBSUEsRUFBRUEsSUFBSUEsRUFBRUEsS0FBS0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDNUNBLENBQUNBO1FBQ0ZBLENBQUNBO0lBQ0ZBLENBQUNBO0lBakNEO21DQWlDQyxDQUFBO0lBRUQsMkJBQTJCLElBQVMsRUFBRSxJQUFTLEVBQUUsS0FBVyxFQUFFLElBQVc7UUFDeEVDLElBQUlBLGFBQWFBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBO1FBRS9CQSxJQUFJQSxLQUFrQkEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBaENBLE1BQU1BLGNBQUVBLEtBQUtBLFdBQW1CQSxDQUFDQTtRQUV0Q0EsSUFBSUEsUUFBUUEsR0FBR0EsSUFBSUEsd0JBQVlBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1FBQzlDQSxJQUFJQSxDQUFDQSxHQUFHQSxJQUFJQSxNQUFNQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFBQTtRQUUvQ0EsSUFBSUEsRUFBRUEsR0FBR0EsVUFBQ0EsTUFBTUEsRUFBRUEsTUFBTUE7WUFDdkJBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLGFBQWFBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLEVBQUVBLE1BQU1BLENBQUNBLENBQUNBO1FBQy9DQSxDQUFDQSxDQUFDQTtRQUNGQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNsQkEsRUFBRUEsQ0FBQ0EsS0FBS0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7SUFDakJBLENBQUNBO0lBRUQsc0JBQXNCLElBQVMsRUFBRSxJQUFTLEVBQUUsS0FBVyxFQUFFLElBQVc7UUFDbkVDLENBQUNBLFVBQVNBLElBQUlBLEVBQUVBLElBQUlBLEVBQUVBLEtBQUtBLEVBQUVBLElBQUlBO1lBQ2hDLElBQUksS0FBa0IsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBaEMsTUFBTSxjQUFFLEtBQUssV0FBbUIsQ0FBQztZQUV0QyxJQUFJLFFBQVEsR0FBRyxJQUFJLHdCQUFZLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQzlDLElBQUksRUFBRSxHQUFHLFVBQUMsTUFBTSxFQUFFLE1BQU07Z0JBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDO1lBQzFCLENBQUMsQ0FBQztZQUNGLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDbEIsRUFBRSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNoQixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqQyxDQUFDLENBQUNBLENBQUNBLElBQUlBLEVBQUVBLElBQUlBLEVBQUVBLEtBQUtBLEVBQUVBLElBQUlBLENBQUNBLENBQUFBO0lBRTVCQSxDQUFDQTtJQUVELElBQUksWUFBWSxHQUFHLFVBQVUsQ0FBQztJQUM5QixJQUFJLGNBQWMsR0FBRyxRQUFRLENBQUM7SUFFOUIsd0NBQXdDLElBQVMsRUFBRSxJQUFTLEVBQUUsS0FBVyxFQUFFLElBQVc7UUFDckZDLFlBQVlBLENBQUNBLFNBQVNBLEdBQUdBLENBQUNBLENBQUNBO1FBQzNCQSxjQUFjQSxDQUFDQSxTQUFTQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUU3QkEsSUFBSUEsTUFBTUEsR0FBR0EsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7YUFDckNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBO2FBQ1ZBLEdBQUdBLENBQUNBLFVBQUFBLEtBQUtBLElBQUtBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLEVBQUVBLENBQUFBLENBQUFBLENBQUNBLENBQUNBO2FBQ25DQSxHQUFHQSxDQUFDQSxVQUFBQSxLQUFLQTtZQUNUQSxJQUFJQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQTtZQUNuQ0EsTUFBTUEsQ0FBQ0EsT0FBT0EsS0FBS0EsS0FBS0EsV0FBV0EsR0FBR0EsS0FBS0EsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDckRBLENBQUNBLENBQUNBLENBQUNBO1FBRUpBLG1FQUFtRUE7UUFFbkVBLElBQUlBLFlBQVlBLEdBQUdBLGNBQWNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRWhEQSxJQUFJQSxLQUFrQkEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsRUFBeENBLE1BQU1BLGNBQUVBLEtBQUtBLFdBQTJCQSxDQUFDQTtRQUV4Q0EsSUFBS0EsQ0FBQ0EsZUFBZUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDdkNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsQ0FBQ0EsR0FBR0EsVUFBQUEsS0FBS0E7WUFDMUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLE1BQU1BLENBQUNBLENBQUNBO1FBQzdCQSxDQUFDQSxDQUFBQTtJQUNGQSxDQUFDQTtJQUVELCtCQUErQixJQUFTLEVBQUUsSUFBUyxFQUFFLEtBQVcsRUFBRSxJQUFXO1FBQzVFQyxJQUFJQSxLQUFrQkEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBaENBLE1BQU1BLGNBQUVBLEtBQUtBLFdBQW1CQSxDQUFDQTtRQUVoQ0EsSUFBS0EsQ0FBQ0EsZUFBZUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDdkNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsQ0FBQ0EsR0FBR0EsVUFBQUEsS0FBS0E7WUFDMUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1FBQzNCQSxDQUFDQSxDQUFBQTtJQUNGQSxDQUFDQTtJQUdELDZCQUE2QixJQUFTLEVBQUUsSUFBUyxFQUFFLEtBQVc7UUFDN0RDLElBQUlBLFVBQVVBLEdBQUdBLElBQUlBLHNCQUFVQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUU5REE7Ozs7Ozs7OztVQVNFQTtJQUNIQSxDQUFDQSIsImZpbGUiOiJiaW5kL2JpbmRhdHRyaWJ1dGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge3JlZ2V4fSBmcm9tIFwiLi9iaW5kXCJcclxuaW1wb3J0IHtBdHRyaWJ1dGVzfSBmcm9tIFwiLi4vYXR0cmlidXRlL2F0dHJpYnV0ZVwiXHJcbmltcG9ydCBNb2RlbCBmcm9tIFwiLi9tb2RlbFwiXHJcbmltcG9ydCB7UGF0aE9ic2VydmVyfSBmcm9tIFwib2JzZXJ2ZWpzXCJcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGJpbmRBdHRyaWJ1dGUobm9kZTpOb2RlLCBhdHRyOkF0dHIsIG1vZGVsOk1vZGVsKTogdm9pZCB7XHJcblx0XHJcblx0Ly9UT0RPIHVzZSBCaW5kaW5nc1xyXG5cdC8vVE9ETyBhbHNvIGRldGVjdCBDdXN0b21BdHRyaWJ1dGUgd2l0aCBub24te3t9fSBWYWx1ZXNcclxuXHQvL1RPRE8gY2FsbCBBbHRlcm5hdGl2ZSBpZiB7ey4qfX0gZG9lcyBub3QgbWF0Y2g6IHNldFByb3BlcnR5XHJcblx0XHJcblx0aWYoQXR0cmlidXRlc1thdHRyLm5hbWUudG9Mb3dlckNhc2UoKV0gIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0cmV0dXJuIGJpbmRDdXN0b21BdHRyaWJ1dGUobm9kZSwgYXR0ciwgbW9kZWwpO1xyXG5cdH1cclxuXHRyZWdleC5sYXN0SW5kZXggPSAwO1xyXG5cdGxldCBtYXRjaCA9IHJlZ2V4LmV4ZWMoYXR0ci52YWx1ZSk7XHJcblx0aWYobWF0Y2gpIHtcclxuXHRcdGxldCBwYXRoID0gbWF0Y2hbMV07XHJcblx0XHRcclxuXHRcdGlmKCEhL1xcKC4qXFwpLy5leGVjKGF0dHIudmFsdWUpKSB7XHJcblx0XHRcdGJpbmRGdW5jdGlvbldpdGhQYXJhbUF0dHJpYnV0ZShub2RlLCBhdHRyLCBtb2RlbCwgcGF0aCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmKHR5cGVvZiBtb2RlbC5nZXQocGF0aCkudmFsdWUgPT09IFwiZnVuY3Rpb25cIikge1xyXG5cdFx0XHRiaW5kRnVuY3Rpb25BdHRyaWJ1dGUobm9kZSwgYXR0ciwgbW9kZWwsIHBhdGgpO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRlbHNlIGlmKCEhKDxhbnk+bm9kZSkucHJvcGVydGllcyAmJiAoPGFueT5ub2RlKS5wcm9wZXJ0aWVzLmluZGV4T2YoYXR0ci5uYW1lKSA+IC0xKSB7XHJcblx0XHRcdGJpbmRQcm9wZXJ0eShub2RlLCBhdHRyLCBtb2RlbCwgcGF0aCk7XHJcblx0XHR9XHJcblx0XHQvKlxyXG5cdFx0ZWxzZSBpZihhdHRyLm5hbWVbMF0gPT09ICcjJykge1xyXG5cdFx0XHRiaW5kUHJvcGVydHkobm9kZSwgYXR0ciwgbW9kZWwsIHBhdGgpO1xyXG5cdFx0fVxyXG5cdFx0Ki9cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRiaW5kVGV4dEF0dHJpYnV0ZShub2RlLCBhdHRyLCBtb2RlbCwgcGF0aCk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5mdW5jdGlvbiBiaW5kVGV4dEF0dHJpYnV0ZShub2RlOk5vZGUsIGF0dHI6QXR0ciwgbW9kZWw6TW9kZWwsIHBhdGg6c3RyaW5nKTogdm9pZCB7XHJcblx0bGV0IG9yaWdpbmFsVmFsdWUgPSBhdHRyLnZhbHVlO1xyXG5cdFxyXG5cdGxldCB7b2JqZWN0LCB2YWx1ZX0gPSBtb2RlbC5nZXQocGF0aCk7XHJcblx0XHJcblx0bGV0IG9ic2VydmVyID0gbmV3IFBhdGhPYnNlcnZlcihvYmplY3QsIHBhdGgpO1xyXG5cdGxldCByID0gbmV3IFJlZ0V4cChcIlxce1xce1wiICsgcGF0aCArIFwiXFx9XFx9XCIsIFwiZ1wiKVxyXG5cdFxyXG5cdGxldCBjYiA9IChuZXdWYWwsIG9sZFZhbCkgPT4ge1xyXG5cdFx0YXR0ci52YWx1ZSA9IG9yaWdpbmFsVmFsdWUucmVwbGFjZShyLCBuZXdWYWwpO1xyXG5cdH07XHJcblx0b2JzZXJ2ZXIub3BlbihjYik7XHJcblx0Y2IodmFsdWUsIG51bGwpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBiaW5kUHJvcGVydHkobm9kZTpOb2RlLCBhdHRyOkF0dHIsIG1vZGVsOk1vZGVsLCBwYXRoOnN0cmluZyk6IHZvaWQge1xyXG5cdChmdW5jdGlvbihub2RlLCBhdHRyLCBtb2RlbCwgcGF0aCkge1xyXG5cdFx0bGV0IHtvYmplY3QsIHZhbHVlfSA9IG1vZGVsLmdldChwYXRoKTtcclxuXHRcdFxyXG5cdFx0bGV0IG9ic2VydmVyID0gbmV3IFBhdGhPYnNlcnZlcihvYmplY3QsIHBhdGgpO1xyXG5cdFx0bGV0IGNiID0gKG5ld1ZhbCwgb2xkVmFsKSA9PiB7XHJcblx0XHRcdG5vZGVbYXR0ci5uYW1lXSA9IG5ld1ZhbDtcclxuXHRcdH07XHJcblx0XHRvYnNlcnZlci5vcGVuKGNiKTtcclxuXHRcdGNiKHZhbHVlLCBudWxsKTtcclxuXHRcdG5vZGUucmVtb3ZlQXR0cmlidXRlKGF0dHIubmFtZSk7XHJcblx0fSkobm9kZSwgYXR0ciwgbW9kZWwsIHBhdGgpXHJcblx0XHJcbn1cclxuXHJcbmxldCByZWdleF9wYXJhbXMgPSAvXFwoKC4rKVxcKS87XHJcbmxldCByZWdleF9mdW5jdGlvbiA9IC8oLiopXFwoLztcclxuXHJcbmZ1bmN0aW9uIGJpbmRGdW5jdGlvbldpdGhQYXJhbUF0dHJpYnV0ZShub2RlOk5vZGUsIGF0dHI6QXR0ciwgbW9kZWw6TW9kZWwsIHBhdGg6c3RyaW5nKTogdm9pZCB7XHJcblx0cmVnZXhfcGFyYW1zLmxhc3RJbmRleCA9IDA7XHJcblx0cmVnZXhfZnVuY3Rpb24ubGFzdEluZGV4ID0gMDtcclxuXHRcclxuXHRsZXQgcGFyYW1zID0gcmVnZXhfcGFyYW1zLmV4ZWMocGF0aClbMV1cclxuXHRcdC5zcGxpdChcIixcIilcclxuXHRcdC5tYXAocGFyYW0gPT4ge3JldHVybiBwYXJhbS50cmltKCl9KVxyXG5cdFx0Lm1hcChwYXJhbSA9PiB7XHJcblx0XHRcdGxldCB2YWx1ZSA9IG1vZGVsLmdldChwYXJhbSkudmFsdWU7XHJcblx0XHRcdHJldHVybiB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIgPyBwYXJhbSA6IHZhbHVlO1xyXG5cdFx0fSk7XHJcblx0XHRcclxuXHQvL1RPRE8gbWFwIHBhcmFtcyB0byB0eXBlcyBlLmcuICd0cnVlJyB0byBib29sZWFuLCAxLjIgdG8gbnVtYmVyLi4uXHJcblx0XHRcclxuXHRsZXQgZnVuY3Rpb25OYW1lID0gcmVnZXhfZnVuY3Rpb24uZXhlYyhwYXRoKVsxXTtcclxuXHRcclxuXHRsZXQge29iamVjdCwgdmFsdWV9ID0gbW9kZWwuZ2V0KGZ1bmN0aW9uTmFtZSk7XHJcblx0XHJcblx0KDxhbnk+bm9kZSkucmVtb3ZlQXR0cmlidXRlKGF0dHIubmFtZSk7XHJcblx0bm9kZVthdHRyLm5hbWUudG9Mb2NhbGVMb3dlckNhc2UoKV0gPSBldmVudCA9PiB7XHJcblx0XHR2YWx1ZS5hcHBseShvYmplY3QsIHBhcmFtcyk7XHJcblx0fVxyXG59XHJcblxyXG5mdW5jdGlvbiBiaW5kRnVuY3Rpb25BdHRyaWJ1dGUobm9kZTpOb2RlLCBhdHRyOkF0dHIsIG1vZGVsOk1vZGVsLCBwYXRoOnN0cmluZyk6IHZvaWQge1xyXG5cdGxldCB7b2JqZWN0LCB2YWx1ZX0gPSBtb2RlbC5nZXQocGF0aCk7XHJcblx0XHJcblx0KDxhbnk+bm9kZSkucmVtb3ZlQXR0cmlidXRlKGF0dHIubmFtZSk7XHJcblx0bm9kZVthdHRyLm5hbWUudG9Mb2NhbGVMb3dlckNhc2UoKV0gPSBldmVudCA9PiB7XHJcblx0XHR2YWx1ZS5jYWxsKG9iamVjdCwgZXZlbnQpO1xyXG5cdH1cclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIGJpbmRDdXN0b21BdHRyaWJ1dGUobm9kZTpOb2RlLCBhdHRyOkF0dHIsIG1vZGVsOk1vZGVsKTogdm9pZCB7XHJcblx0bGV0IGN1c3RvbUF0dHIgPSBuZXcgQXR0cmlidXRlc1thdHRyLm5hbWVdKG5vZGUsIGF0dHIsIG1vZGVsKTtcclxuXHRcclxuXHQvKlxyXG5cdGxldCB7b2JqZWN0LCB2YWx1ZX0gPSBtb2RlbC5nZXQocGF0aCk7XHJcblx0XHJcblx0bGV0IG9ic2VydmVyID0gbmV3IFBhdGhPYnNlcnZlcihvYmplY3QsIHBhdGgpO1xyXG5cdGxldCBjYiA9IChuZXdWYWwsIG9sZFZhbCkgPT4ge1xyXG5cdFx0Y3VzdG9tQXR0ci5uZXdKU1ZhbHVlKG5ld1ZhbCk7XHJcblx0fTtcclxuXHRvYnNlcnZlci5vcGVuKGNiKTtcclxuXHRjYih2YWx1ZSwgbnVsbCk7XHJcblx0Ki9cclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==